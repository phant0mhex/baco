<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-50">
<head>
  <meta charset="UTF-8">
  <title>Admin - Portail BACO</title>
    <link rel="icon" type="image/png" href="favicon.jpg">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist&family=Geist+Mono&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/lucide@0.303.0/dist/umd/lucide.min.js" defer></script>  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
<script src="https://unpkg.com/flatpickr"></script>
  <script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>
<link rel="stylesheet" href="https://unpkg.com/flatpickr/dist/flatpickr.min.css">

  <link rel="stylesheet" href="https://unpkg.com/notyf@3/notyf.min.css">
  <script src="https://unpkg.com/notyf@3/notyf.min.js"></script>
  
  <!-- <script src="js/auth.js"></script>  -->
  <script src="js/core/layout.js" type="module"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Geist', 'sans-serif'],
            mono: ['Geist Mono', 'monospace'],
          },
        },
      },
    }
  </script>
  <style>
  /* Cacher le corps par défaut jusqu'à ce que l'auth soit vérifiée */
  body {
    visibility: hidden;
  }
</style>
</head>
<body class="h-full flex flex-col min-h-screen bg-gray-50">

  <div id="nav-placeholder"></div>

  <div class="flex-grow">
    <div class="container mx-auto p-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-8">Tableau de bord Administrateur</h1>

      <div class="bg-white p-6 rounded-lg shadow border border-gray-200 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Créer un nouvel utilisateur</h2>
        <form id="create-user-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label for="new-user-email" class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" id="new-user-email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="new-user-password" class="block text-sm font-medium text-gray-700">Mot de passe</label>
            <input type="text" id="new-user-password" required minlength="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="new-user-role" class="block text-sm font-medium text-gray-700">Rôle</label>
            <select id="new-user-role" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="user">Utilisateur</option>
              <option value="moderator">Modérateur</option>
              <option value="admin">Administrateur</option>
            </select>
          </div>
          <div class="flex items-end">
            <button type="submit" id="create-user-button" class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-colors">
              <i data-lucide="user-plus" class="w-4 h-4"></i>
              <span>Créer</span>
            </button>
          </div>
        </form>
        <p class="mt-3 text-xs text-gray-500">Note : Assurez-vous d'avoir désactivé la "Confirmation par email" dans les réglages d'authentification de Supabase.</p>
      </div>

      <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Gestion des Utilisateurs</h2>
        <div id="user-list-container">
          </div>
      </div>
    </div>
  </div>

  <div id="infraction-history-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
    <div class="flex justify-between items-center p-4 border-b">
      <h3 id="history-modal-title" class="text-xl font-semibold text-gray-800">Casier de...</h3>
      <button type="button" onclick="hideInfractionHistoryModal()" class="p-1 rounded-full text-gray-500 hover:bg-gray-200">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    </div>
    
    <div id="infraction-history-list" class="p-6 space-y-3 max-h-[60vh] overflow-y-auto">
      <div class="flex justify-center items-center py-10">
          <i data-lucide="loader-2" class="w-8 h-8 text-blue-600 animate-spin"></i>
      </div>
    </div>
    
    <div class="flex justify-end items-center p-4 bg-gray-50 border-t rounded-b-lg">
      <button type="button" onclick="hideInfractionHistoryModal()" class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
        Fermer
      </button>
    </div>
  </div>
</div>

  <div id="infraction-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
    <form id="infraction-form">
      <div class="flex justify-between items-center p-4 border-b">
        <h3 class="text-xl font-semibold text-gray-800">Ajouter une Infraction</h3>
        <button type="button" onclick="hideInfractionModal()" class="p-1 rounded-full text-gray-500 hover:bg-gray-200">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <div class="p-6 space-y-4">
        <input type="hidden" id="infraction-user-id">
        <p>Utilisateur: <strong id="infraction-user-email"></strong></p>

        <div>
          <label for="infraction-card-type" class="block text-sm font-medium text-gray-700">Type de Carton</label>
          <select id="infraction-card-type" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="yellow">Jaune</option>
            <option value="red">Rouge</option>
          </select>
        </div>

        <div>
          <label for="infraction-reason" class="block text-sm font-medium text-gray-700">Raison</label>
          <textarea id="infraction-reason" rows="3" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500" placeholder="Ex: Non-respect de la procédure X..."></textarea>
        </div>
      </div>

      <div class="flex justify-end items-center p-4 bg-gray-50 border-t rounded-b-lg">
        <button type="button" onclick="hideInfractionModal()" class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">Annuler</button>
        <button type="submit" id="confirm-infraction-button" class="ml-3 px-4 py-2 bg-yellow-500 text-white border border-transparent rounded-md shadow-sm hover:bg-yellow-600">
          Donner le Carton
        </button>
      </div>
    </form>
  </div>
</div>

<div id="reset-password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
    <div class="flex justify-between items-center p-4 border-b">
      <h3 class="text-xl font-semibold text-gray-800">Réinitialiser le mot de passe</h3>
      <button type="button" onclick="hideResetPasswordModal()" class="p-1 rounded-full text-gray-500 hover:bg-gray-200">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    </div>
    
    <div class="p-6 space-y-4">
      <p class="text-gray-700">Vous êtes sur le point de générer un nouveau mot de passe pour <strong id="reset-user-email"></strong>.</p>
      
      <div>
        <label for="new-random-password" class="block text-sm font-medium text-gray-700 mb-1">Nouveau mot de passe généré :</label>
        <div class="flex items-center gap-2">
          <input type="text" id="new-random-password" readonly class="font-mono text-lg block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100">
          <button type="button" id="copy-password-button" class="p-2 text-gray-600 rounded-md hover:bg-gray-100" title="Copier">
             <i data-lucide="copy" class="w-5 h-5"></i>
          </button>
        </div>
        <p class="text-xs text-red-500 mt-1">⚠️ Ce mot de passe est temporaire et doit être communiqué à l'utilisateur.</p>
      </div>

      <div id="reset-status-message" class="text-sm"></div>
    </div>
    
    <div class="flex justify-end items-center p-4 bg-gray-50 border-t rounded-b-lg">
      <button type="button" onclick="hideResetPasswordModal()" class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none">
        Annuler
      </button>
      <button type="button" id="confirm-reset-button" class="ml-3 px-4 py-2 bg-red-600 text-white border border-transparent rounded-md shadow-sm hover:bg-red-700 focus:outline-none">
        Confirmer la réinitialisation
      </button>
    </div>
  </div>
</div>
<div id="footer-placeholder"></div>

<script src="js/pages/admin.js" type="module"></script>
</body>
</html>